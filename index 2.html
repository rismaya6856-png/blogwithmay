<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Shareable Blog</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--muted:#94a3b8;--accent:#60a5fa}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#07102b, #071634);color:#e6eef8;margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .wrap{width:100%;max-width:880px}
    header{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    .card{background:rgba(255,255,255,0.03);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    label{display:block;margin-top:10px;color:var(--muted);font-size:13px}
    input[type=text],textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;resize:vertical}
    textarea{min-height:180px}
    .row{display:flex;gap:10px;margin-top:12px}
    button{background:var(--accent);color:#04203a;border:0;padding:10px 12px;border-radius:10px;cursor:pointer}
    .linkbox{margin-top:12px;padding:12px;background:rgba(255,255,255,0.02);border-radius:8px;word-break:break-all}
    .preview{margin-top:18px}
    .post-title{font-size:22px;margin:0 0 8px 0}
    .post-body{white-space:pre-wrap;line-height:1.6;color:#d8e6fb}
    .small{font-size:12px;color:var(--muted)}
    a.small{color:var(--accent)}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Simple Shareable Blog — single file</h1>
        <div class="small">Tulis, buat link, dan bagikan. Host file ini (index.html) di GitHub Pages / Netlify.</div>
      </div>
    </header>

    <main class="card">
      <div id="app">
        <!-- If URL has ?p=base64, show the post. Otherwise show editor -->
      </div>

      <div class="preview" id="preview-area" style="display:none">
        <h2 class="post-title" id="preview-title"></h2>
        <div class="post-body" id="preview-body"></div>
      </div>

      <footer>
        <div class="small">Cara kerja: editor meng-encode isi posting ke base64 lalu membuat link berbentuk <code>?p=...</code>. Tidak perlu server. Untuk membagikan, upload file ini ke layanan hosting statis dan bagikan URL.</div>
      </footer>
    </main>
  </div>

<script>
(function(){
  const app = document.getElementById('app');
  const params = new URLSearchParams(location.search);
  const p = params.get('p');

  function escapeHtml(s){ return s.replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  if(p){
    // show post mode
    let ok = true;
    try{ var raw = atob(p); }catch(e){ ok=false }
    if(ok){
      const data = JSON.parse(raw);
      document.getElementById('preview-title').textContent = data.title || '(tanpa judul)';
      document.getElementById('preview-body').innerHTML = data.html || ('<pre>' + escapeHtml(data.text||'') + '</pre>');
      document.getElementById('preview-area').style.display = 'block';
      // also add a share button
      const b = document.createElement('div'); b.style.marginTop='12px'; b.innerHTML = '<a href="' + location.origin + location.pathname + '" class="small">← Back to editor</a>';
      document.querySelector('.card').appendChild(b);
    } else {
      app.innerHTML = '<div class="small">Link tidak valid atau rusak. <a href="'+location.origin+location.pathname+'">Kembali ke editor</a></div>';
    }
    return;
  }

  // editor UI
  app.innerHTML = `
    <div>
      <label>Judul</label>
      <input id="title" type="text" placeholder="Judul tulisanmu...">
      <label>Isi (bisa HTML sederhana atau teks biasa)</label>
      <textarea id="content" placeholder="Tulis ceritamu di sini..."></textarea>
      <div class="row">
        <button id="gen">Buat Link</button>
        <button id="preview">Pratinjau</button>
        <button id="clear" style="background:#334155;color:#fff">Kosongkan</button>
      </div>
      <div id="linkbox" class="linkbox" style="display:none"></div>
    </div>
  `;

  const titleEl = document.getElementById('title');
  const contentEl = document.getElementById('content');
  const linkbox = document.getElementById('linkbox');

  document.getElementById('gen').addEventListener('click', ()=>{
    const obj = { title: titleEl.value.trim(), text: contentEl.value, html: null };
    // allow user to use minimal HTML: detect if content contains <p> or <br>
    if(/<[^>]+>/.test(obj.text)) obj.html = obj.text.replaceAll('\n','<br>');
    const s = JSON.stringify(obj);
    const enc = btoa(unescape(encodeURIComponent(s)));
    const url = location.origin + location.pathname + '?p=' + enc;
    linkbox.style.display='block';
    linkbox.innerHTML = '<div class="small">Link siap dibagikan:</div><div><a href="'+url+'" target="_blank">'+url+'</a></div>';
  });

  document.getElementById('preview').addEventListener('click', ()=>{
    const obj = { title: titleEl.value.trim(), text: contentEl.value, html: null };
    document.getElementById('preview-title').textContent = obj.title || '(tanpa judul)';
    document.getElementById('preview-body').textContent = obj.text || '';
    document.getElementById('preview-area').style.display = 'block';
    setTimeout(()=>{ window.scrollTo({top:document.getElementById('preview-area').offsetTop, behavior:'smooth'}); }, 50);
  });

  document.getElementById('clear').addEventListener('click', ()=>{ titleEl.value=''; contentEl.value=''; linkbox.style.display='none'; document.getElementById('preview-area').style.display='none'; });

})();
</script>
</body>
</html>
